{"ast":null,"code":"'use strict';\n\nvar UNICODE = require(\"../common/unicode\");\n\nvar $ = UNICODE.CODE_POINTS;\n\nfunction isSurrogatePair(cp1, cp2) {\n  return cp1 >= 0xD800 && cp1 <= 0xDBFF && cp2 >= 0xDC00 && cp2 <= 0xDFFF;\n}\n\nfunction getSurrogatePairCodePoint(cp1, cp2) {\n  return (cp1 - 0xD800) * 0x400 + 0x2400 + cp2;\n}\n\nvar DEFAULT_BUFFER_WATERLINE = 1 << 16;\n\nvar Preprocessor = module.exports = function () {\n  this.html = null;\n  this.pos = -1;\n  this.lastGapPos = -1;\n  this.lastCharPos = -1;\n  this.droppedBufferSize = 0;\n  this.gapStack = [];\n  this.skipNextNewLine = false;\n  this.lastChunkWritten = false;\n  this.endOfChunkHit = false;\n  this.bufferWaterline = DEFAULT_BUFFER_WATERLINE;\n};\n\nObject.defineProperty(Preprocessor.prototype, 'sourcePos', {\n  get: function get() {\n    return this.droppedBufferSize + this.pos;\n  }\n});\n\nPreprocessor.prototype.dropParsedChunk = function () {\n  if (this.pos > this.bufferWaterline) {\n    this.lastCharPos -= this.pos;\n    this.droppedBufferSize += this.pos;\n    this.html = this.html.substring(this.pos);\n    this.pos = 0;\n    this.lastGapPos = -1;\n    this.gapStack = [];\n  }\n};\n\nPreprocessor.prototype._addGap = function () {\n  this.gapStack.push(this.lastGapPos);\n  this.lastGapPos = this.pos;\n};\n\nPreprocessor.prototype._processHighRangeCodePoint = function (cp) {\n  if (this.pos !== this.lastCharPos) {\n    var nextCp = this.html.charCodeAt(this.pos + 1);\n\n    if (isSurrogatePair(cp, nextCp)) {\n      this.pos++;\n      cp = getSurrogatePairCodePoint(cp, nextCp);\n\n      this._addGap();\n    }\n  } else if (!this.lastChunkWritten) {\n      this.endOfChunkHit = true;\n      return $.EOF;\n    }\n\n  return cp;\n};\n\nPreprocessor.prototype.write = function (chunk, isLastChunk) {\n  if (this.html) this.html += chunk;else this.html = chunk;\n  this.lastCharPos = this.html.length - 1;\n  this.endOfChunkHit = false;\n  this.lastChunkWritten = isLastChunk;\n};\n\nPreprocessor.prototype.insertHtmlAtCurrentPos = function (chunk) {\n  this.html = this.html.substring(0, this.pos + 1) + chunk + this.html.substring(this.pos + 1, this.html.length);\n  this.lastCharPos = this.html.length - 1;\n  this.endOfChunkHit = false;\n};\n\nPreprocessor.prototype.advance = function () {\n  this.pos++;\n\n  if (this.pos > this.lastCharPos) {\n    if (!this.lastChunkWritten) this.endOfChunkHit = true;\n    return $.EOF;\n  }\n\n  var cp = this.html.charCodeAt(this.pos);\n\n  if (this.skipNextNewLine && cp === $.LINE_FEED) {\n    this.skipNextNewLine = false;\n\n    this._addGap();\n\n    return this.advance();\n  }\n\n  if (cp === $.CARRIAGE_RETURN) {\n    this.skipNextNewLine = true;\n    return $.LINE_FEED;\n  }\n\n  this.skipNextNewLine = false;\n  return cp >= 0xD800 ? this._processHighRangeCodePoint(cp) : cp;\n};\n\nPreprocessor.prototype.retreat = function () {\n  if (this.pos === this.lastGapPos) {\n    this.lastGapPos = this.gapStack.pop();\n    this.pos--;\n  }\n\n  this.pos--;\n};","map":{"version":3,"sources":["/Users/adarsh/Documents/StocksUI/node_modules/react-native-parse-html/lib/tokenizer/preprocessor.js"],"names":["UNICODE","require","$","CODE_POINTS","isSurrogatePair","cp1","cp2","getSurrogatePairCodePoint","DEFAULT_BUFFER_WATERLINE","Preprocessor","module","exports","html","pos","lastGapPos","lastCharPos","droppedBufferSize","gapStack","skipNextNewLine","lastChunkWritten","endOfChunkHit","bufferWaterline","Object","defineProperty","prototype","get","dropParsedChunk","substring","_addGap","push","_processHighRangeCodePoint","cp","nextCp","charCodeAt","EOF","write","chunk","isLastChunk","length","insertHtmlAtCurrentPos","advance","LINE_FEED","CARRIAGE_RETURN","retreat","pop"],"mappings":"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","sourcesContent":["'use strict';\n\nvar UNICODE = require('../common/unicode');\n\n//Aliases\nvar $ = UNICODE.CODE_POINTS;\n\n//Utils\n\n//OPTIMIZATION: these utility functions should not be moved out of this module. V8 Crankshaft will not inline\n//this functions if they will be situated in another module due to context switch.\n//Always perform inlining check before modifying this functions ('node --trace-inlining').\nfunction isSurrogatePair(cp1, cp2) {\n    return cp1 >= 0xD800 && cp1 <= 0xDBFF && cp2 >= 0xDC00 && cp2 <= 0xDFFF;\n}\n\nfunction getSurrogatePairCodePoint(cp1, cp2) {\n    return (cp1 - 0xD800) * 0x400 + 0x2400 + cp2;\n}\n\n\n//Const\nvar DEFAULT_BUFFER_WATERLINE = 1 << 16;\n\n\n//Preprocessor\n//NOTE: HTML input preprocessing\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#preprocessing-the-input-stream)\nvar Preprocessor = module.exports = function () {\n    this.html = null;\n\n    this.pos = -1;\n    this.lastGapPos = -1;\n    this.lastCharPos = -1;\n    this.droppedBufferSize = 0;\n\n    this.gapStack = [];\n\n    this.skipNextNewLine = false;\n\n    this.lastChunkWritten = false;\n    this.endOfChunkHit = false;\n    this.bufferWaterline = DEFAULT_BUFFER_WATERLINE;\n};\n\nObject.defineProperty(Preprocessor.prototype, 'sourcePos', {\n    get: function () {\n        return this.droppedBufferSize + this.pos;\n    }\n});\n\nPreprocessor.prototype.dropParsedChunk = function () {\n    if (this.pos > this.bufferWaterline) {\n        this.lastCharPos -= this.pos;\n        this.droppedBufferSize += this.pos;\n        this.html = this.html.substring(this.pos);\n        this.pos = 0;\n        this.lastGapPos = -1;\n        this.gapStack = [];\n    }\n};\n\nPreprocessor.prototype._addGap = function () {\n    this.gapStack.push(this.lastGapPos);\n    this.lastGapPos = this.pos;\n};\n\nPreprocessor.prototype._processHighRangeCodePoint = function (cp) {\n    //NOTE: try to peek a surrogate pair\n    if (this.pos !== this.lastCharPos) {\n        var nextCp = this.html.charCodeAt(this.pos + 1);\n\n        if (isSurrogatePair(cp, nextCp)) {\n            //NOTE: we have a surrogate pair. Peek pair character and recalculate code point.\n            this.pos++;\n            cp = getSurrogatePairCodePoint(cp, nextCp);\n\n            //NOTE: add gap that should be avoided during retreat\n            this._addGap();\n        }\n    }\n\n    // NOTE: we've hit the end of chunk, stop processing at this point\n    else if (!this.lastChunkWritten) {\n        this.endOfChunkHit = true;\n        return $.EOF;\n    }\n\n    return cp;\n};\n\nPreprocessor.prototype.write = function (chunk, isLastChunk) {\n    if (this.html)\n        this.html += chunk;\n\n    else\n        this.html = chunk;\n\n    this.lastCharPos = this.html.length - 1;\n    this.endOfChunkHit = false;\n    this.lastChunkWritten = isLastChunk;\n};\n\nPreprocessor.prototype.insertHtmlAtCurrentPos = function (chunk) {\n    this.html = this.html.substring(0, this.pos + 1) +\n                chunk +\n                this.html.substring(this.pos + 1, this.html.length);\n\n    this.lastCharPos = this.html.length - 1;\n    this.endOfChunkHit = false;\n};\n\n\nPreprocessor.prototype.advance = function () {\n    this.pos++;\n\n    if (this.pos > this.lastCharPos) {\n        if (!this.lastChunkWritten)\n            this.endOfChunkHit = true;\n\n        return $.EOF;\n    }\n\n    var cp = this.html.charCodeAt(this.pos);\n\n    //NOTE: any U+000A LINE FEED (LF) characters that immediately follow a U+000D CARRIAGE RETURN (CR) character\n    //must be ignored.\n    if (this.skipNextNewLine && cp === $.LINE_FEED) {\n        this.skipNextNewLine = false;\n        this._addGap();\n        return this.advance();\n    }\n\n    //NOTE: all U+000D CARRIAGE RETURN (CR) characters must be converted to U+000A LINE FEED (LF) characters\n    if (cp === $.CARRIAGE_RETURN) {\n        this.skipNextNewLine = true;\n        return $.LINE_FEED;\n    }\n\n    this.skipNextNewLine = false;\n\n    //OPTIMIZATION: first perform check if the code point in the allowed range that covers most common\n    //HTML input (e.g. ASCII codes) to avoid performance-cost operations for high-range code points.\n    return cp >= 0xD800 ? this._processHighRangeCodePoint(cp) : cp;\n};\n\nPreprocessor.prototype.retreat = function () {\n    if (this.pos === this.lastGapPos) {\n        this.lastGapPos = this.gapStack.pop();\n        this.pos--;\n    }\n\n    this.pos--;\n};\n\n"]},"metadata":{},"sourceType":"script"}